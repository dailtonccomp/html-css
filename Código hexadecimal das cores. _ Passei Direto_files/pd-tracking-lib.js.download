var pdTrackingLib=function(){var e={utils:{},services:{}};return e.utils.ajaxRequest=function(){function e(e,i,t,n,s,o){const a=window.location.host.indexOf(".studenta.com")>-1?i.replace(".passeidireto.com",".studenta.com"):i;var r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState==XMLHttpRequest.DONE)if(r.status>=200&&r.status<=299)s(r.responseText&&""!=r.responseText?JSON.parse(r.responseText):null);else{o({status:r.status,data:r.responseText});const e=new CustomEvent("httpErrorEvent",{detail:{error:{response:r}}});window.dispatchEvent(e)}},r.open(e,a,!0),r.withCredentials=!0,r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Accept","application/json"),r.setRequestHeader("pd-app-client-id",n.id||n.name),r.setRequestHeader("pd-app-client-version",n.version),"POST"==e?r.send(JSON.stringify(t)):r.send()}return{ajaxRequest:e}}(),e.utils.cookies=function(){function i(e){var i=document.cookie.match(new RegExp(e+"=([^;]+)"));try{i&&(i=JSON.parse(i[1]))}catch(t){i&&(i=i[1])}return i}function t(e,i){i=i||a,document.cookie=[e,"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/; domain=",i].join("")}function n(e,i){var t=[e,"=",JSON.stringify(i),"; domain=",a,"; path=/;"].join("");document.cookie=t}function s(e,i){if(!i[e]||"function"!=typeof i[e])throw new Error("Invalid "+e+" function")}function o(i){s("setCookie",i),s("getCookie",i),s("removeCookie",i),Object.assign({},e.utils.cookies,i)}var a=window.location.host.indexOf(".studenta.com")>-1?".studenta.com":".passeidireto.com";return{setCookie:n,getCookie:i,removeCookie:t,overrideCookiesUtils:o}}(),e.utils.debounce=function(){function e(e,i,t){var n;return function(){var s=this,o=arguments,a=function(){n=null,t||e.apply(s,o)},r=t&&!n;clearTimeout(n),n=setTimeout(a,i),r&&e.apply(s,o)}}return{debounce:e}}(),e.services.eventTracking=function(){function i(e){o=e}function t(){return window.location.search.slice(1).split("&").filter(function(e){return e.startsWith("pd_")}).join("&")}function n(i,n,s){n.PdUtm=t();var a={SessionId:s,EventName:i,Data:n,TrackingLibVersion:"12.0.19"};console.log("[PD Tracking Lib]",i,JSON.stringify(a));var r="https://tracking-api.passeidireto.com",c=r+"/track";e.utils.ajaxRequest.ajaxRequest("POST",c,a,o.clientData,function(){},function(e){console.error("[PD Tracking Lib] Something went wrong with event tracking",e)})}function s(i,t,a){var r=e.services.sessionTracking.getSessionId(),c=parseInt("500"),u=parseInt("10000")/c;r>0||o&&o.anonymous?n(i,t,r):u>a?(console.warn("[PD Tracking Lib] Session Tracking is not ready, delaying to send. Attempt:",++a),setTimeout(function(){s(i,t,a)},c)):console.error("[PD Tracking Lib] Session Tracking is not ready, giving up")}var o;return{track:function(e,i){return s(e,i,0)},init:i}}(),e.services.materialReadTracking=function(){function i(i){c=i,e.services.sessionActivity.isSessionActive()?(t(),r=setInterval(function(){e.services.eventTracking.track("MaterialRead",{MaterialId:i,MaterialReadInterval:a})},a),e.services.sessionActivity.bindSessionInactiveCallback(s)):s()}function t(){r&&(clearInterval(r),r=null),e.services.sessionActivity.unbindSessionInactiveCallback(s),e.services.sessionActivity.unbindSessionActiveCallback(n)}function n(){i(c),e.services.sessionActivity.unbindSessionActiveCallback(n)}function s(){t(),e.services.sessionActivity.bindSessionActiveCallback(n)}function o(){t(),c=null}const a=parseInt("10000");var r,c;return{startMaterialRead:i,stopMaterialRead:o}}(),e.services.materialWatchedTracking=function(){function i(i){r=i,t(),a=setInterval(function(){e.services.eventTracking.track(o,{MaterialId:i,MaterialWatchedInterval:s,OnTab:!document.hidden})},s)}function t(){a&&(clearInterval(a),a=null)}function n(){t(),r=null}const s=parseInt("10000"),o="MaterialWatched";var a,r;return{startMaterialWatched:i,stopMaterialWatched:n}}(),e.services.sessionActivity=function(){function i(e){if(!e.anonymous&&(!e.userId||e.userId<1))throw new Error("Invalid userId");if(!e.currentLocation)throw new Error("Invalid currentLocation");if(!e.clientData)throw new Error("Invalid clientData");if((!e.clientData.id||e.clientData.id<1)&&!e.clientData.name)throw new Error("Invalid clientData.id and clientData.name");if(!e.clientData.version)throw new Error("Invalid clientData.version")}function t(t,n,s){n="undefined"==typeof n?function(){}:n,s="undefined"==typeof s?function(){}:s,i(t),k=t,e.services.sessionTracking.init(k),e.services.eventTracking.init(k),t.anonymous?n():e.services.sessionTracking.trackSession(n,s)}function n(){o(),e.services.sessionTracking.trackSession()}function s(){o(!0)}function o(e){p?clearTimeout(p):e||(console.log("[PD Tracking Lib]","Session active"),setTimeout(function(){g.forEach(function(e){e()})})),p=setTimeout(function(){p=null,console.log("[PD Tracking Lib]","Session inative"),T.forEach(function(e){e()})},e?0:f)}function a(e){g.push(e)}function r(e){var i=g.indexOf(e);g.splice(i,1)}function c(e){T.push(e)}function u(e){var i=T.indexOf(e);T.splice(i,1)}function l(){return!!p}var d=e.utils.debounce;const v=500,f=parseInt("600000");var k,p,g=[],T=[];const m=d.debounce(n,v);return{initSession:t,userActivityEventListener:m,userInactivityEventListener:s,bindSessionActiveCallback:a,unbindSessionActiveCallback:r,bindSessionInactiveCallback:c,unbindSessionInactiveCallback:u,isSessionActive:l}}(),e.services.sessionTracking=function(){function i(e){const i=c.clientData.id;return e+"_"+i}function t(e){c=e}function n(t,n){const s=window.location.href,u=document.referrer,l=e.utils.cookies.getCookie("first_accessed_page"),d=e.utils.cookies.getCookie("first_accessed_page_referer"),v=c.userId;e.utils.cookies.setCookie(i(o),(new Date).toISOString());var f="https://session-tracking-api.passeidireto.com",k=f+"/session/"+v+"/track";const p={currentUrl:s,referrerUrl:u,FirstAccessedPage:l,FirstAccessedPageReferrer:d};console.log("[PD Tracking Lib]","SessionTracking",JSON.stringify(p)),e.utils.ajaxRequest.ajaxRequest("POST",k,p,c.clientData,function(s){s?(r=s.SessionId,e.utils.cookies.setCookie(i(a),r),t()):(r=-1,n())},function(t){console.error("[PD Tracking Lib] Something went wrong with session tracking",t),r=-1,503!==t.status&&(e.utils.cookies.removeCookie(i(o)),e.utils.cookies.removeCookie(i(a))),n(t)})}function s(t,s){t="undefined"==typeof t?function(){}:t,s="undefined"==typeof s?function(){}:s;var c=e.utils.cookies.getCookie(i(o));if(!c)return n(t,s);c=new Date(c);var u=new Date,l=Math.abs(c-u);l>=parseInt("3600000")?n(t,s):r||(r=e.utils.cookies.getCookie(i(a)),t())}const o="last-session-tracking-call",a="last-session-tracking-id";var r,c;return{init:t,trackSession:s,getSessionId:function(){return r},getSessionKey:function(){return c.sessionKey}}}(),{overrideCookiesUtils:e.utils.cookies.overrideCookiesUtils,initSession:e.services.sessionActivity.initSession,userActivityEventListener:e.services.sessionActivity.userActivityEventListener,userInactivityEventListener:e.services.sessionActivity.userInactivityEventListener,trackEvent:e.services.eventTracking.track,startMaterialRead:e.services.materialReadTracking.startMaterialRead,stopMaterialRead:e.services.materialReadTracking.stopMaterialRead,startMaterialWatched:e.services.materialWatchedTracking.startMaterialWatched,stopMaterialWatched:e.services.materialWatchedTracking.stopMaterialWatched,version:"12.0.19"}}();